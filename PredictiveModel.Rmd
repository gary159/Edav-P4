---
title: "Predictive_Model"
author: "Team"
date: "April 28, 2016"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(knitr)
library(zoo)
library(ggplot2)
library(scales)
library(zoo)

#install.packages("devtools")
#devtools::install_github("twitter/AnomalyDetection")

library(AnomalyDetection)
library(googleVis)
op <- options(gvis.plot.tag='chart')

setwd("/Users/bobminnich/Documents/Columbia/Courses/DataVisualization/Final_Project/Edav-P4")

df = readRDS("full_filtered2.rds")
df$Created.Date = as.character(df$Created.Date)
```


```{r}
library(lubridate)
library(zoo)
library(forecast)

df$Created.Date = mdy_hms(df$Created.Date)

df2 = df
df2$day = day(df2$Created.Date)
df2$year = year(df2$Created.Date)
df2$month = month(df2$Created.Date)

df3 = group_by(df2, day,month, year) %>%summarise(count = n())
df3$date = paste(df3$day,df3$month,df3$year, sep = "/")
df3$date = dmy(df3$date)

df4 = data.frame(df3$date)
df4$count = df3$count
colnames(df4) = c("date", "count")


#Limit df4 just to 2015
df5 = filter(df4, year(df4$date) <2016)
```


http://www.analyticsvidhya.com/blog/2015/12/complete-tutorial-time-series-modeling/
```{r}
library(tseries)

myts <- ts(df5$count, start=c(year(min(df5$date)), month(min(df5$date)),day(min(df5$date))),end=c(year(max(df5$date)), month(max(df5$date)), day(max(df5$date))), frequency=365) 

decomp = decompose(myts)
plot(myts)
plot(decomp$seasonal)
plot(myts - decomp$seasonal)


#Check for  stationary
a = adf.test(diff(log(myts)), alternative="stationary", k=0)
Box.test(myts, lag = 20, type = "Ljung-Box")
kpss.test(myts)


#Conclued that the data is Stationary
Acf(myts)
# This plot suggests a Moving Asverage of 2
Pacf(myts)


#Suggests AR(2) Due to the PACF Plot
#http://www.statosphere.com.au/check-time-series-stationary-r/

fit <- arima(log(myts), c(0, 0, 2),seasonal = list(order = c(0, 1, 1), period = 365.25))
accuracy(fit)
plot(forecast(fit, h = 10))


#decomp = decompose(log(myts)
#fit <- arima(log(myts),seasonal = decomp$seasonal,  order= c(3, 0, 0))

```

