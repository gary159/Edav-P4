<!--
Required copyright information for w3c_slidy:

   Copyright (c) 2005-2013 W3C (MIT, ERCIM, Keio), All Rights Reserved.
   W3C liability, trademark, document use and software licensing
   rules apply, see:

   http://www.w3.org/Consortium/Legal/copyright-documents
   http://www.w3.org/Consortium/Legal/copyright-software

   Defines single name "w3c_slidy" in global namespace
   Adds event handlers without trampling on any others

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="font-size-adjustment" content="-2" />
<link rel="stylesheet" href="slidy.css" type="text/css" />
<link rel="stylesheet" href="w3c-blue.css" type="text/css" />
<script src="slidy.js" charset="utf-8" type="text/javascript">
</script>
</head>
<body>
<div class="background"></a></object></div>
<div class="background slanty">

</div>
<div class="slide cover title">

<img src="Frozen2.jpg" alt="NYC Subzero"
 class="cover" /><br clear="all" />
<h1>NYC Chaos Day</h1>

<h2>team name</h2><br />
<br />
<br />
<br />
<br /><em>Hit the space bar or swipe left for next slide</em></p>
</div>

<!--            Intro             -->
<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Introduction </font></center>
<br />
<br />
<br />

<div class="container">

<p style="font-size:40px">
Analyzing the <b>worst</b> day </p> </br>

<div align="center"> 
<p style="font-size:60px">
New York </p> </br>
</div>

<font size="12">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;
has experienced </font> </br> </br>

<font size="6">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;
in the past few years </font> </br> </br>
<div align = "right">
<font size="6">
in terms of 311 complains</font>
</div>
</div>
</div>


<!--            Identification             -->
<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Identification of “Chaos Day”
 </font></center>
<br />
<br />
<br />
</div>



<!--            Exploration             -->
<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Exploring Complaints </font></center>
<br />
<br />
<br />
<p>We continue our investigation by plotting the top ten 311 complaint categories for January 8th according to census tracts as shown below. </p>
<iframe src="https://patrick-rogan.shinyapps.io/shiny/" width="100%" height="800px" frameborder="0"></iframe>
<br />
<br />
<p>We see that the complaint categories have different distributions throughout New York City. For example, heat and hot water complaints appear to be clustered around the northern edge of Manhattan, in the lower Bronx and around the center of Brooklyn. However, other categories such as unsanitary condition appear to be uniformly distributed throughout the city. </p>
</div>

<!--            Car Collisions             -->
<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> NYC Car Collisions on Jan 08, 2015 </font></center>
<br />
<br />
<br />
  <li>What made today so bad for NYC? Was it a bad day for traffic?</li>
  <li>The time lapse plot (link below) will show you the number collisions that occured on Jan 08, 2015. The collisions will appear at the time they happened. The colors are related to the type of vehicle that was involved in the collision.</li>
</ul>

<center><IMG SRC="figs/Collisions.png" float = "center" ALT="image" height="550" width="800"></center>
<a href="http://bl.ocks.org/minnich49/raw/fbeb70700c7c870ea016a28c4918f322/">Link to D3 NYC Car Collisions</a>

</div>


<!--            Historical Car Collisions             -->
<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Comparison to Historcal Collisions in NYC  </font></center>
<br />
<br />
<br />
<div>
  <IMG SRC="figs/Car_Histogram.png" float = "left" ALT="image"  height="400" width="400">
  <IMG SRC="figs/Car_Violin_Bur.png" float = "right" ALT="image"  height="400" width="600">
</div>

  <li>We can see from the red line in the upper left plot, that January 8, 2015 was a pretty typical day in terms of car collisions at 505 total.</li>
  <li>There was even a day that had over 900 collisions, which was during a major winter storm.</li>
  <li>To insure that this horrible day did not just affect a single burrow, the plot on the left shows the historical distributions for each Borough, where the balck dot indicates January 8, 2015</li>
  <li>Still nothing abormal about this day</li>

</ul>

</div>

<!--            Agency             -->
<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Relationship Between Agencies, Complaints, and Boroughs </font></center>
<br/>
<br/>
<br/>
The 311 Service Requests contain many subfields including agency and borough. Here we focus on relationship between agencies, boroughs, and complaints. We use Saneky diagrams to show the relationships between these variables. To put January 8th in perspective, we compare both the anomaly day and the complaints from an entire year. 

```{r, echo=FALSE, warning=FALSE, message=FALSE}

## Preparation for sankey diagram and work cloud
if (!require("googleVis")) {
  install.packages(c("devtools","RJSONIO", "knitr", "shiny", "httpuv"))
  library(devtools)
  install_github("mages/googleVis")
}
if (!require("wordcloud")) {
  install.packages("wordcloud")
}

library(wordcloud)
library(googleVis)
op <- options(gvis.plot.tag="chart")

#### data for sankey diagram
load("sankey_anomal_day.Rda")
load("sankey_2015_top3.Rda")

#### data for word cloud
load("word_anomal_day.Rda")

```
A Sankey diagram of anomaly day is shown below. Here we see the relationship between complaint type and agencies, as well as the relationship between agencies and boroughs. 

<p style="text-align: left; font-size:20px; font-weight:bold;">Sankey diagram between complaints, agencies, and boroughs at anomaly day</p>
<center>
```{r results='asis', tidy=TRUE, echo=FALSE, fig.align='center'}
plot(data_jan_08_output[[1]])
```
</center>
<br />
In the above diagram, there are many complaints directed to HPD (Housing Preservation & Development) on January 8th. Among these, there are 5225 complaints classified as HEAT/HOT WATER which is the largest complaint category for this day. We also see other complaints such as plumbing or DOOR/WINDOW. Furthermore we observe the relationships between agencies and boroughs. For example, the numbers of complaints directed to HPD are the largest in Brooklyn. 

Another Sankey diagram of anomaly day is shown below. In this diagram, we can see the relationship between agencies and boroughs, and the relationship between boroughs and complaints.  

<p style="text-align: left; font-size:20px; font-weight:bold;">Sankey diagram between agencies, boroughs, and complaints at anomaly day</p>
<center>
```{r results='asis', tidy=TRUE, echo=FALSE, fig.align='center'}
plot(data_jan_08_output[[2]])
```
</center>
<br />
In the diagram above, we can see the direct relationship between borough and complaint type. We can see that complaints of HEAT/HOT WATER are most prevalent in Brooklyn. From this result, we can also assume that some incidents related to water happened at the anomaly day. 

A Sankey diagram for a full year of complaints is shown below. In this diagram, we see the relationship between complaint type and agencies, and the relationship between agencies and boroughs. Here, we picked the top three agencies that had largest numbers of complaints on the anomaly day to compare the yearly data and anomaly data. 

<p style="text-align: left; font-size:20px; font-weight:bold;">Sankey diagram between complaints, agencies, and boroughs at 2015</p>
<center>
```{r results='asis', tidy=TRUE, echo=FALSE}
plot(data_2015_2016_TOP3_output[[1]])
```
</center>
<br />
In the diagram above we show the number of complaints directed to HPD, DOT or NYPD during 2015 and 2016. As we can see above, complaints of HEATING are the largest, however, complaints of HEAT/HOT WATER that was the largest numbers of complaints at anomaly day is not the largest in total. Hence, we can say that at the anomaly day, the numbers of complaints of HEAT/HOT WATER was very high compared with annual data. In addition, the numbers of complaints directed to HPD in Brooklyn was the largest (1076902), and it may be possible that houses or buildings at Brooklyn may have some issue related to water or heating.

As shown above, HPD had the most complaints. We then look at the descriptions written in these complaints. 

Here is the description information of complains directed to HPD at the anomaly day (Jan/8/2015).

```{r, echo=FALSE, fig.width = 3, fig.height = 3, fig.align='center'}
dtm = JAN_08_2015_mining_HPD[[1]]
mfreq = colSums(as.matrix(dtm))

set.seed(429) 
wordcloud(names(mfreq),mfreq,
          min.freq=0,
          scale=c(4,0.5),
          colors=brewer.pal(8, "Dark2"),
          random.color=FALSE, 
          random.order=FALSE)
```

As we can see, words that are related to housing such as 'building' and 'apartment' are prevalent. From the previous analysis about complaint type, we know that there are many HEAT/HOT WATER complaints. This wordcloud is consistent with the distribution of complaints for this day.

</div>


<!--            Agency Response Time Analysis             -->
<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Agency Response Time Analysis  </font></center>
<br />
<br />
<br />
The majority of complaints in Jan 2015 went to two agencies: HPD and DOT. We'd like to summarize the efficiency of these agencies in closing complaints assigned to them over an extended time period. <br />

Specifically, we want to look at the window between Jan 1st and Jan 15th, which is a week before/after the chaos day Jan 8th. Furthermore, we will focus on the Manhattan borough as it is where the majority of the report authors are located.
<br />

We are curious if there is any pattern within agencies. For example, whether HPD's response time to one type of complaint is affected by the other complaints? How was their efficiency in closing complaints that were created on the chaos day compared to other days? 
<br />
<br />

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(plotly)
load("HPD_manhattan.Rda")
load("DOT_manhattan.Rda")
load("HPD_corr.Rda")
load("DOT_corr.Rda")
```

<center>
```{r, echo=FALSE, fig.width=4.5, fig.height=4.5}
par(mfrow=c(1,2))
plot(HPD_corr, main="HPD response time correlation")
plot(DOT_corr, main="DOT response time correlation")
```
</center>
<br />
<p>The pair correlations between types of complaints are very random for each agency. We then move on to visualize the response time by complaint categories for two agencies. </p>
<br />
<br />
<br />
<center>
```{r, echo=FALSE, warning=FALSE, message=FALSE}
### Jan 1st to Jan 15th. 

plot_ly(data = HPD_manhattan[1:75,], x = date, y = response, type='bar',color =complaint)%>%
  layout(title="Average days for HPD to close different complaints (reported in Manhattan)")

```
</center>

HPD is relatively efficient in fixing the Heat/Hot Water complaints, which is necessary because these are more urgent when compared to other complaints during the winter days. <br />

<p>This is also the case for complaints created on Jan 8th. If the reader hovers over Jan 8th, they will see that HPD took longer time closing Plumbing, Door/Window, Unsanitary Condition, Paint/Plaster issues than closing Heat/Hot Water complaints. </p>
<br />
<br />
<center>
```{r, echo=FALSE, warning=FALSE, message=FALSE}
plot_ly(data = DOT_manhattan[1:75,], x = date, y = response, type='bar', color =complaint)%>%
  layout(title="Average days for DOT to close different complaints (reported in Manhattan)")
````
</center>

DOT's response efficiency differs among types of complaints as well, here the contrast between response times is more obvious. Highway Condition and Traffic Signal Condition are more urgent than other cases and as such the DOT may work harder to resolve these issues.
<br />

From the visualization, we do not find pattern that could summarize the agency's response time to different complaints over the week before/after Jan 8th. This is understandable as the urgency of complaints and other exogenous factors may affect the agency's efficiency. 
<br />
<br />
<br />
<br />

</div>
<!-- ############################# -->

<!--            Prediction Model Approach     -->
<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Prediction Model - Approach </font></center>
<br />
<br />
<br />
  <li>Time series analysis was unable to accuractly predict number of counts per day due to volatile changes from day to day.</li>
  <li>Turned to Random Forest Regression in order to account for highly non-linear data. While it will be shown this model has difficulties detcting anomolies, we will see that there is still a large benefit for the 311 team in knowing what their next day will be, in order to properly staff for the incoming complaints.</li>
  <li>Aggregated all of the complaints into daily counts and used the previous 4 days of information to predict the Count of that day(shown below as Day_Lag_1 to Day_Lag_4).</li>
  <li>The initial features are the previous 4 days. Count is what is attempting to be predicted.</li>
</ul>

<center><IMG SRC="figs/explanation.jpg" float = "center" ALT="image" height="600" width="800"></center>


</div>
<!--            Prediction Model Approach End    -->

<!--            Prediction Importance     -->
<div class="slide">
<br />

<center><font size="6" color ='#ffffff'> Prediction Model - Importance Factors </font></center>
<br />
<br />
<br />
  <li>Model 1: The upper left plot was the initial model that only included the Counts from Daily Lags</li>
  <li>Model 2: The upper right plot was the second model that added Weather (Minimum and Maximum Temp) and Month to Model 1</li>
  <li>Model 3: The lower left plot was the third model that added Change Between Lags, which is the difference between Day_Lag_1 and Day_Lag_2, Day_Lag_2 and Day_Lag_3 etc</li>
  <li>Model 4: The lower right plot was the fourth model that added Weekday, which is a label for the 7 days of the week. Sunday is 1...Saturday is 7</li>
  <li>We can see that the Change Between Lags and the Weekday had a large change on the order of imporatance for the Random Forest Regression.</li>
  <li>From the importance plots below it can be determined that Saturday and Fridays have added a large contribution to the final model. Suprisingly, after adding the days the Minimum and Maximum Temper importance increased.</li>

</ul>

<center><IMG SRC="figs/Importance.png" float = "center" ALT="image" height="600" width="800"></center>

</div>
<!--            Prediction Model Importance End    -->



<!--            Prediction RMSE     -->
<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Prediction Model - RMSE </font></center>
<br />
<br />
<br />
  <li>A single prediction was made based on all of the previous days within the dataset. For example, to predict January 1, 2004, all previous days were used as training to predict the next day. This was done for ~200 days, which can be seen in the plots below. </li>
  <li>For each prediction (Count) there were 4 previous days and other features,depending on the model, to help with the predictions.</li>
  <li>Root Mean Squared Error was calculated to commpare models</li>
  <li>After initial testing with Random Forests the RMSE needed to improve on the more volatile days</li>
  <li>Adding the Changes Between Lags and the Weekday had the greatest improvement on RMSE, therefore Model 4 was chosen (All previous features + Weekday)</li>
</ul>


<center><IMG SRC="figs/RMSE.png" float = "center" ALT="image" height="550" width="800"></center>

</div>
<!--            Prediction Model RMSE End    -->

<!--            Prediction ModelTime Series and Conclusin/Improvements     -->
<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Prediction Model - Predictions </font></center>
<br />
<br />
<br />
  <li>We can see from the plots below that Model 4 does a good job of following the trends that are seen within daily complaints</li>
  <li>The model has difficulties in predicting the extremely volatile days but still does a good job of holding the correect trend.</li>
  <li>The memory of the model can sometimes hurt the performance, as inbetween 11/21/2015 and 12/01/2015, the predictive model consistently experiecnes a dip</li>
  <li>So while the initial goal started out to predict anamolies, we found that most of the anamolies occured around the days after New Years Eve, when many 311 workers would come back to work on the backlog of complaints. We believe that this model helps the 311 team understand on a day to day basis on how many complaints they will have in their next day and can help adjust their staff accordingly.</li>
</ul>

  <span style="float:center;width: 20%;">
    <center><IMG SRC="figs/Predictions.png" float = "center" ALT="image" height="600" width="800"></center>
  </span>
</div>
<!--            Prediction Time Series and Conclusin/Improvements     -->


<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Conclusion </font></center>
<br />
<br />
<br />
<p>
</p>
<br />
</div>

<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> Team </font></center>
<br />
<br />
<br />
<p>
</p>
<br />
</div>

<div class="slide">
<br/>
<center><font size="6" color ='#ffffff'> References </font></center>
<br />
<br />
<br />
<p>
<b>311 | City of New York </b><br>
http://www1.nyc.gov/311/<br>
</p>
<br />
</div>

